<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تسجيل مورد | شركة السعودية للأعمال والتشغيل والصناعة</title>
  <meta name="description" content="نموذج تسجيل الموردين لدى شركة السعودية للأعمال والتشغيل والصناعة و شركات المجموعة." />

  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1a30;
      --card2:#0c1528;
      --text:#e7eefc;
      --muted:#a9b7d5;
      --line:rgba(255,255,255,.10);
      --accent:#4f8cff;
      --accent2:#2fe0b7;
      --danger:#ff5a6b;
      --ok:#2fe07a;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Kufi Arabic", Tahoma, Arial, sans-serif;
      background:
        radial-gradient(900px 600px at 15% 10%, rgba(79,140,255,.20), transparent 60%),
        radial-gradient(800px 600px at 85% 25%, rgba(47,224,183,.14), transparent 60%),
        radial-gradient(900px 700px at 60% 100%, rgba(255,90,107,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      line-height:1.5;
    }
    a{color:inherit}
    .wrap{max-width:1100px; margin:0 auto; padding:28px 18px 60px}
    header{
      display:flex; gap:16px; align-items:flex-start; justify-content:space-between;
      padding:20px;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
    }
    .brand{
      display:flex; gap:14px; align-items:center;
    }
    .logo{
      width:52px; height:52px; border-radius:14px;
      background: linear-gradient(135deg, rgba(79,140,255,.85), rgba(47,224,183,.75));
      box-shadow: 0 10px 30px rgba(79,140,255,.22);
      display:grid; place-items:center;
      font-weight:800;
    }
    .hgroup h1{margin:0; font-size:20px}
    .hgroup p{margin:6px 0 0; color:var(--muted); font-size:14px; max-width:680px}
    .pillrow{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-start}
    .pill{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding:8px 10px;
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    main{display:grid; grid-template-columns: 1fr 360px; gap:16px; margin-top:16px}
    @media (max-width: 980px){ main{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .head{
      padding:16px 18px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.12);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .card .head h2{margin:0; font-size:15px}
    .card .head .small{color:var(--muted); font-size:12px}
    .card .body{padding:18px}

    .grid{display:grid; gap:12px}
    .grid.two{grid-template-columns: 1fr 1fr}
    .grid.three{grid-template-columns: 1fr 1fr 1fr}
    @media (max-width: 720px){
      .grid.two,.grid.three{grid-template-columns:1fr}
    }

    label{display:block; font-size:13px; color:var(--muted); margin-bottom:6px}
    input, select, textarea{
      width:100%;
      background: rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.10);
      color:var(--text);
      border-radius:14px;
      padding:12px 12px;
      outline:none;
      transition: .15s ease;
    }
    input:focus, select:focus, textarea:focus{border-color: rgba(79,140,255,.65); box-shadow: 0 0 0 4px rgba(79,140,255,.12)}
    textarea{min-height:110px; resize:vertical}

    .hint{font-size:12px; color:var(--muted); margin-top:6px}
    .req{color: var(--accent2); font-weight:700}

    .checkgrid{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px; padding:10px;
      border:1px dashed rgba(255,255,255,.14);
      border-radius:14px;
      background: rgba(0,0,0,.10);
    }
    @media(max-width:720px){ .checkgrid{grid-template-columns:1fr} }
    .chk{
      display:flex; gap:10px; align-items:center;
      padding:10px; border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      background: rgba(255,255,255,.02);
    }
    .chk input{width:auto}
    .row{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      padding:12px; border:1px solid var(--line); border-radius:14px;
      background: rgba(0,0,0,.08);
    }

    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:flex-start; align-items:center;
    }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding:12px 14px;
      border-radius:14px;
      cursor:pointer;
      transition:.15s ease;
      font-weight:650;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.20)}
    .btn.primary{
      border-color: rgba(79,140,255,.55);
      background: linear-gradient(135deg, rgba(79,140,255,.95), rgba(47,224,183,.65));
      color:#061124;
    }
    .btn.danger{border-color: rgba(255,90,107,.40); color:#ffd7dc}
    .status{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      color:var(--muted);
      font-size:13px;
    }
    .status.ok{border-color: rgba(47,224,122,.45); color: rgba(196,255,220,.95)}
    .status.bad{border-color: rgba(255,90,107,.45); color: rgba(255,214,219,.95)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}

    .sidebar .body{display:grid; gap:12px}
    .kv{
      padding:12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      background: rgba(0,0,0,.10);
    }
    .kv b{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    .kv span{display:block; font-size:14px}
    .note{
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:13px;
    }
    .footer{
      margin-top:16px;
      color:rgba(255,255,255,.35);
      font-size:12px;
      text-align:center;
    }
    .hidden{display:none !important;}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">S</div>
        <div class="hgroup">
          <h1>نموذج تسجيل الموردين</h1>
          <p>
            تسجيل الموردين لدى <b>شركة السعودية للأعمال والتشغيل والصناعة</b> وشركات المجموعة (أكثر من 15 شركة)
            عبر قطاعات: الاتصالات، الطاقة المتجددة، مبيعات الجملة، المقاولات، ومجالات الصناعة.
          </p>
          <div class="pillrow" style="margin-top:10px">
            <div class="pill">Vendor Registration</div>
            <div class="pill">Telecom</div>
            <div class="pill">Renewable Energy</div>
            <div class="pill">Wholesale</div>
            <div class="pill">Contracting</div>
            <div class="pill">Industrial</div>
          </div>
        </div>
      </div>

      <div style="min-width:220px">
        <div class="pill" style="margin-bottom:10px">رقم الطلب: <span id="appId" class="mono">—</span></div>
        <div class="pill">آخر حفظ تلقائي: <span id="lastSaved">—</span></div>
      </div>
    </header>

    <main>
      <!-- FORM -->
      <section class="card">
        <div class="head">
          <h2>بيانات المورد</h2>
          <div class="small">الحقول المطلوبة عليها علامة <span class="req">*</span></div>
        </div>

        <div class="body">
          <!-- IMPORTANT:
               GitHub Pages doesn't receive form submissions by itself.
               Use Formspree: create a form and put your endpoint below.
               Replace YOUR_FORMSPREE_ID
          -->
          <form id="vendorForm"
                action="https://formspree.io/f/YOUR_FORMSPREE_ID"
                method="POST"
                enctype="multipart/form-data">

            <!-- hidden metadata -->
            <input type="hidden" name="application_id" id="application_id" />
            <input type="hidden" name="page_source" value="GitHub Pages" />

            <!-- Company Profile -->
            <div class="card" style="background: rgba(0,0,0,.10); margin-bottom:12px">
              <div class="head">
                <h2>1) ملف الشركة</h2>
                <div class="small">Company Profile</div>
              </div>
              <div class="body">
                <div class="grid two">
                  <div>
                    <label>الاسم القانوني للشركة <span class="req">*</span></label>
                    <input name="company_legal_name" required placeholder="مثال: مؤسسة / شركة ..." />
                  </div>
                  <div>
                    <label>الاسم التجاري (اختياري)</label>
                    <input name="trade_name" placeholder="Brand / Trade name" />
                  </div>
                </div>

                <div class="grid three" style="margin-top:12px">
                  <div>
                    <label>الدولة <span class="req">*</span></label>
                    <input name="country" required placeholder="Saudi Arabia" />
                  </div>
                  <div>
                    <label>المدينة <span class="req">*</span></label>
                    <input name="city" required placeholder="Riyadh" />
                  </div>
                  <div>
                    <label>سنة التأسيس</label>
                    <input name="year_established" type="number" min="1900" max="2100" placeholder="2015" />
                  </div>
                </div>

                <div style="margin-top:12px">
                  <label>رابط المصنع / المتجر / الموقع <span class="req">*</span></label>
                  <input name="website_or_factory_link" required type="url" placeholder="https://..." />
                  <div class="hint">لو ما عندك موقع، حط رابط خرائط Google أو LinkedIn أو كتالوج PDF.</div>
                </div>

                <div style="margin-top:12px">
                  <label>النشاط الرئيسي <span class="req">*</span></label>
                  <input name="main_activity" required placeholder="مثال: مقاولات كهرباء / توريد معدات اتصالات ..." />
                </div>

                <div style="margin-top:12px">
                  <label>القطاعات التي يمكنك التوريد لها <span class="req">*</span></label>
                  <div class="checkgrid" id="sectorsGrid">
                    <label class="chk"><input type="checkbox" name="sectors[]" value="Telecommunications"> الاتصالات (Telecommunications)</label>
                    <label class="chk"><input type="checkbox" name="sectors[]" value="Renewable Energy"> الطاقة المتجددة (Renewable Energy)</label>
                    <label class="chk"><input type="checkbox" name="sectors[]" value="Wholesale / Distribution"> مبيعات الجملة (Wholesale)</label>
                    <label class="chk"><input type="checkbox" name="sectors[]" value="Contracting"> المقاولات (Contracting)</label>
                    <label class="chk"><input type="checkbox" name="sectors[]" value="Industrial / Manufacturing"> الصناعة (Industrial)</label>
                    <label class="chk"><input type="checkbox" id="sectorOtherChk"> أخرى</label>
                  </div>

                  <div id="sectorOtherWrap" class="hidden" style="margin-top:10px">
                    <label>اذكر القطاع الآخر</label>
                    <input name="sector_other" placeholder="اكتب القطاع..." />
                  </div>

                  <div class="hint">اختر على الأقل قطاع واحد.</div>
                </div>
              </div>
            </div>

            <!-- Products / Services -->
            <div class="card" style="background: rgba(0,0,0,.10); margin-bottom:12px">
              <div class="head">
                <h2>2) المنتجات / الخدمات</h2>
                <div class="small">Products / Services</div>
              </div>
              <div class="body">
                <div class="grid two">
                  <div>
                    <label>نوع المورد <span class="req">*</span></label>
                    <select name="vendor_type" required>
                      <option value="" selected disabled>اختر</option>
                      <option>مصنع (Manufacturer)</option>
                      <option>موزع (Distributor)</option>
                      <option>مقدم خدمة (Service Provider)</option>
                      <option>مقاول (Contractor)</option>
                      <option>آخر (Other)</option>
                    </select>
                  </div>
                  <div>
                    <label>الفئة (Category)</label>
                    <select name="category">
                      <option value="" selected>اختر (اختياري)</option>
                      <option>Telecom Equipment</option>
                      <option>Solar / PV</option>
                      <option>Electrical</option>
                      <option>Construction Materials</option>
                      <option>Industrial Supplies</option>
                      <option>Spare Parts</option>
                      <option>Other</option>
                    </select>
                  </div>
                </div>

                <div style="margin-top:12px">
                  <label>وصف مختصر لما تقدمه <span class="req">*</span></label>
                  <textarea name="offering_description" required placeholder="اكتب وصف واضح ومختصر..."></textarea>
                </div>

                <div class="grid three" style="margin-top:12px">
                  <div>
                    <label>مدة التوريد المعتادة</label>
                    <select name="typical_lead_time">
                      <option value="" selected>اختياري</option>
                      <option>1-3 days</option>
                      <option>4-7 days</option>
                      <option>1-2 weeks</option>
                      <option>3-4 weeks</option>
                      <option>4+ weeks</option>
                    </select>
                  </div>
                  <div>
                    <label>الطاقة / القدرة (Capacity)</label>
                    <input name="capacity" placeholder="مثال: 5000 وحدة/شهر" />
                  </div>
                  <div>
                    <label>الحد الأدنى للطلب (MOQ)</label>
                    <input name="moq" placeholder="مثال: 100" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Compliance & Docs -->
            <div class="card" style="background: rgba(0,0,0,.10); margin-bottom:12px">
              <div class="head">
                <h2>3) المستندات والامتثال</h2>
                <div class="small">Compliance & Documents</div>
              </div>
              <div class="body">
                <div class="note">
                  على GitHub Pages: رفع الملفات داخل النموذج قد لا يعمل بدون منصة تستقبلها (مثل Netlify).
                  الحل المضمون: ارفع ملفاتك على Google Drive/OneDrive وأدخل روابطها هنا.
                </div>

                <div class="grid two" style="margin-top:12px">
                  <div>
                    <label>رابط السجل التجاري / الملف التعريفي <span class="req">*</span></label>
                    <input name="documents_link_cr_profile" required type="url" placeholder="https://drive.google.com/..." />
                    <div class="hint">ارفع ملف CR + Company Profile في مجلد واحد وشارك الرابط.</div>
                  </div>
                  <div>
                    <label>رابط الشهادات (ISO / SASO / IEC ...)</label>
                    <input name="documents_link_certificates" type="url" placeholder="https://..." />
                  </div>
                </div>

                <div class="grid two" style="margin-top:12px">
                  <div>
                    <label>رفع السجل التجاري (اختياري/لـ Netlify)</label>
                    <input name="upload_cr" type="file" accept=".pdf,.jpg,.jpeg,.png" />
                  </div>
                  <div>
                    <label>رفع شهادات الجودة (اختياري/لـ Netlify)</label>
                    <input name="upload_certificates" type="file" multiple accept=".pdf,.jpg,.jpeg,.png" />
                  </div>
                </div>

                <div style="margin-top:12px">
                  <label class="chk" style="display:flex;align-items:center;gap:10px">
                    <input type="checkbox" name="declaration" required />
                    أقر أن جميع المعلومات المقدمة صحيحة وأنني مخوّل بالتسجيل نيابة عن الشركة <span class="req">*</span>
                  </label>
                </div>
              </div>
            </div>

            <!-- Contacts -->
            <div class="card" style="background: rgba(0,0,0,.10); margin-bottom:12px">
              <div class="head">
                <h2>4) بيانات التواصل (شخصين)</h2>
                <div class="small">Contacts (Two)</div>
              </div>
              <div class="body">
                <div class="grid two">
                  <div class="kv">
                    <b>جهة التواصل الأولى (Primary)</b>
                    <div class="grid" style="margin-top:10px">
                      <div>
                        <label>الاسم <span class="req">*</span></label>
                        <input name="contact1_name" required />
                      </div>
                      <div>
                        <label>المنصب</label>
                        <input name="contact1_title" />
                      </div>
                      <div class="grid two">
                        <div>
                          <label>الجوال <span class="req">*</span></label>
                          <input name="contact1_mobile" required placeholder="+966..." />
                        </div>
                        <div>
                          <label>الإيميل <span class="req">*</span></label>
                          <input name="contact1_email" required type="email" placeholder="name@company.com" />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="kv">
                    <b>جهة التواصل الثانية (Secondary)</b>
                    <div class="grid" style="margin-top:10px">
                      <div>
                        <label>الاسم <span class="req">*</span></label>
                        <input name="contact2_name" required />
                      </div>
                      <div>
                        <label>المنصب</label>
                        <input name="contact2_title" />
                      </div>
                      <div class="grid two">
                        <div>
                          <label>الجوال <span class="req">*</span></label>
                          <input name="contact2_mobile" required placeholder="+966..." />
                        </div>
                        <div>
                          <label>الإيميل <span class="req">*</span></label>
                          <input name="contact2_email" required type="email" placeholder="name@company.com" />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div style="margin-top:12px">
                  <label>ملاحظات إضافية</label>
                  <textarea name="notes" placeholder="أي تفاصيل إضافية..."></textarea>
                </div>
              </div>
            </div>

            <!-- Submit -->
            <div class="row">
              <div class="actions">
                <button type="submit" class="btn primary">إرسال الطلب</button>
                <button type="button" id="saveBtn" class="btn">حفظ كمسودة</button>
                <button type="button" id="clearBtn" class="btn danger">مسح البيانات</button>
              </div>
              <div id="formStatus" class="status">جاهز</div>
            </div>

            <div class="hint" style="margin-top:10px">
              سيتم إرسال البيانات إلى بريد/لوحة Formspree المرتبطة. إن لم يتم الاتصال بكم فهذا لا يعني رفضًا؛ فقط لم يتم الاحتياج حاليًا.
            </div>

          </form>
        </div>
      </section>

      <!-- SIDEBAR -->
      <aside class="card sidebar">
        <div class="head">
          <h2>معلومات سريعة</h2>
          <div class="small">Quick Info</div>
        </div>
        <div class="body">
          <div class="kv">
            <b>سياسة المراجعة</b>
            <span>كل الطلبات تُراجع حسب الامتثال والقدرة.</span>
          </div>
          <div class="kv">
            <b>أفضل ممارسة للملفات</b>
            <span>ضع روابط Drive/OneDrive بدل رفع مباشر (على GitHub Pages).</span>
          </div>
          <div class="kv">
            <b>تلميح</b>
            <span>اجمع (CR + Profile + Certificates) في مجلد واحد وشارك الرابط.</span>
          </div>
          <div class="note">
            إذا تبغى رفع ملفات فعلي داخل النموذج: انقل نفس الصفحة إلى Netlify Forms، أو استخدم خدمة تدعم file upload.
          </div>
        </div>
      </aside>
    </main>

    <div class="footer">© <span id="year"></span> Saudi Business, Operations & Industry Co. — Vendor Registration</div>
  </div>

  <script>
    const form = document.getElementById('vendorForm');
    const statusEl = document.getElementById('formStatus');
    const appIdEl = document.getElementById('appId');
    const applicationIdInput = document.getElementById('application_id');
    const yearEl = document.getElementById('year');
    const lastSavedEl = document.getElementById('lastSaved');

    const sectorOtherChk = document.getElementById('sectorOtherChk');
    const sectorOtherWrap = document.getElementById('sectorOtherWrap');

    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clearBtn');

    const DRAFT_KEY = "vendor_registration_draft_v1";

    function nowStr(){
      const d = new Date();
      return d.toLocaleString('ar-SA');
    }

    function makeAppId(){
      // SBOI-YYYYMMDD-XXXX
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      const rnd = Math.random().toString(16).slice(2,6).toUpperCase();
      return `SBOI-${y}${m}${day}-${rnd}`;
    }

    function setStatus(type, msg){
      statusEl.classList.remove('ok','bad');
      if(type === 'ok') statusEl.classList.add('ok');
      if(type === 'bad') statusEl.classList.add('bad');
      statusEl.textContent = msg;
    }

    function serializeForm(frm){
      const data = {};
      const fd = new FormData(frm);
      for (const [k,v] of fd.entries()){
        if (v instanceof File) continue; // لا نخزن ملفات في LocalStorage
        if (k.endsWith('[]')){
          data[k] = data[k] || [];
          data[k].push(v);
        } else {
          data[k] = v;
        }
      }
      return data;
    }

    function fillForm(frm, data){
      for (const [k,v] of Object.entries(data)){
        if (Array.isArray(v)){
          // checkboxes array
          const name = k;
          const boxes = frm.querySelectorAll(`input[name="${name}"]`);
          boxes.forEach(b => b.checked = v.includes(b.value));
        } else {
          const el = frm.querySelector(`[name="${CSS.escape(k)}"]`);
          if(!el) continue;
          if(el.type === 'checkbox') el.checked = (v === 'on' || v === true);
          else el.value = v;
        }
      }
    }

    function hasAtLeastOneSector(){
      const selected = form.querySelectorAll('input[name="sectors[]"]:checked');
      const other = sectorOtherChk.checked;
      return selected.length > 0 || other;
    }

    // init
    yearEl.textContent = new Date().getFullYear();
    const appId = makeAppId();
    appIdEl.textContent = appId;
    applicationIdInput.value = appId;

    sectorOtherChk.addEventListener('change', () => {
      sectorOtherWrap.classList.toggle('hidden', !sectorOtherChk.checked);
    });

    // load draft
    try{
      const draftRaw = localStorage.getItem(DRAFT_KEY);
      if(draftRaw){
        const draft = JSON.parse(draftRaw);
        fillForm(form, draft);
        setStatus('ok', 'تم استرجاع مسودة محفوظة');
        lastSavedEl.textContent = 'موجودة';
        // if other sector text present
        if(draft.sector_other && String(draft.sector_other).trim().length > 0){
          sectorOtherChk.checked = true;
          sectorOtherWrap.classList.remove('hidden');
        }
      } else {
        lastSavedEl.textContent = '—';
      }
    }catch(e){}

    // auto save
    let saveTimer = null;
    form.addEventListener('input', () => {
      clearTimeout(saveTimer);
      saveTimer = setTimeout(() => {
        try{
          const draft = serializeForm(form);
          localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
          lastSavedEl.textContent = nowStr();
          setStatus('ok', 'تم حفظ المسودة تلقائيًا');
        }catch(e){}
      }, 600);
    });

    saveBtn.addEventListener('click', () => {
      try{
        const draft = serializeForm(form);
        localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
        lastSavedEl.textContent = nowStr();
        setStatus('ok', 'تم حفظ المسودة');
      }catch(e){
        setStatus('bad', 'تعذر الحفظ');
      }
    });

    clearBtn.addEventListener('click', () => {
      if(!confirm('متأكد تبغى تمسح كل البيانات؟')) return;
      form.reset();
      sectorOtherWrap.classList.add('hidden');
      sectorOtherChk.checked = false;
      localStorage.removeItem(DRAFT_KEY);
      lastSavedEl.textContent = '—';
      setStatus('ok', 'تم مسح البيانات');
    });

    // submit with validation + async submit
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      if(!hasAtLeastOneSector()){
        setStatus('bad', 'اختر قطاع واحد على الأقل');
        document.getElementById('sectorsGrid').scrollIntoView({behavior:'smooth', block:'center'});
        return;
      }

      // If other sector checked, require text
      if(sectorOtherChk.checked){
        const otherText = (form.querySelector('[name="sector_other"]').value || '').trim();
        if(otherText.length < 2){
          setStatus('bad', 'اذكر القطاع الآخر');
          sectorOtherWrap.scrollIntoView({behavior:'smooth', block:'center'});
          return;
        }
      }

      setStatus('', 'جاري الإرسال...');
      const fd = new FormData(form);

      try{
        const res = await fetch(form.action, {
          method: "POST",
          body: fd,
          headers: { "Accept": "application/json" }
        });

        if(res.ok){
          localStorage.removeItem(DRAFT_KEY);
          setStatus('ok', 'تم إرسال الطلب بنجاح ✅');
          form.reset();
          sectorOtherWrap.classList.add('hidden');
          sectorOtherChk.checked = false;
          lastSavedEl.textContent = '—';

          // regenerate new application id
          const newId = makeAppId();
          appIdEl.textContent = newId;
          applicationIdInput.value = newId;

          alert('تم إرسال طلب التسجيل بنجاح. سنقوم بالمراجعة والتواصل عند الحاجة.');
        } else {
          setStatus('bad', 'فشل الإرسال. تحقق من إعداد Formspree أو الاتصال.');
        }
      } catch (err){
        setStatus('bad', 'تعذر الإرسال (قد يكون بسبب Formspree أو الشبكة).');
      }
    });
  </script>
</body>
</html>
